(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{391:function(s,n,a){"use strict";a.r(n);var t=a(4),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"第六篇-如何用高德地图获取定位"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第六篇-如何用高德地图获取定位"}},[s._v("#")]),s._v(" 第六篇，如何用高德地图获取定位！")]),s._v(" "),n("blockquote",[n("p",[s._v("作者："),n("a",{attrs:{href:"https://java.springsongs.cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("极光"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("本站地址："),n("a",{attrs:{href:"http://springsongs.cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://springsongs.cn"),n("OutboundLink")],1),s._v("\n一篇适合初学者的实战指南，带你用"),n("strong",[s._v("高德地图 JS API")]),s._v("打造一个带"),n("strong",[s._v("实时定位")]),s._v("功能的"),n("strong",[s._v("3D地图")]),s._v("页面，完整代码开源，思路详解，避坑提醒。")])]),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"🎯-项目效果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#🎯-项目效果"}},[s._v("#")]),s._v(" 🎯 项目效果")]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20250717150508208","data-src":"http://springsongs.cn/images/image-20250717150508208.png",loading:"lazy"}})]),s._v(" "),n("ul",[n("li",[s._v("🌍 展示桂林市3D地图（深色主题）")]),s._v(" "),n("li",[s._v("📍 支持点击按钮获取“我的位置”")]),s._v(" "),n("li",[s._v("📡 定时刷新，实现“伪实时定位”")]),s._v(" "),n("li",[s._v("📏 自动绘制当前位置精度圆")])]),s._v(" "),n("blockquote",[n("p",[s._v("应用于：共享定位、行程追踪、外勤管理、个人位置展示等场景")])]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"一、项目技术栈"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、项目技术栈"}},[s._v("#")]),s._v(" 一、项目技术栈")]),s._v(" "),n("ul",[n("li",[s._v("高德地图 JS API v2.0")]),s._v(" "),n("li",[s._v("AMap.Geolocation 定位插件")]),s._v(" "),n("li",[s._v("AMap.Object3DLayer 三维地图")]),s._v(" "),n("li",[s._v("Turf.js（可用于空间分析）")])]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"二、核心功能开发"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、核心功能开发"}},[s._v("#")]),s._v(" 二、核心功能开发")]),s._v(" "),n("h3",{attrs:{id:"_1️⃣-3d地图初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1️⃣-3d地图初始化"}},[s._v("#")]),s._v(" 1️⃣ 3D地图初始化")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\t\tlet MapInfo; // 全局地图实例\n        let geolocation; // 定位实例\n        let userMarker; // 用户位置标记\n        let watchIntervalId; // 实时定位监听ID\n        let accuracyCircle; // 精度圆\n\n        // 初始化地图\n        function initMap() {\n            MapInfo = new AMap.Map('AllmapContainer', {\n                viewMode: '2D',\n                center: [110.299, 25.274], // 桂林市中心坐标\n                zoom: 10,\n                mapStyle: \"amap://styles/dark\" // 深色主题\n            });\n\n            // 初始化定位功能\n            initGeolocation();\n        }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("blockquote",[n("p",[s._v("🚩 小技巧：使用"),n("strong",[s._v("mapStyle")]),s._v("可快速切换主题风格，适合夜间展示。")])]),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"_2️⃣-定位模块初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2️⃣-定位模块初始化"}},[s._v("#")]),s._v(" 2️⃣ 定位模块初始化")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 初始化定位功能\n        function initGeolocation() {\n            geolocation = new AMap.Geolocation({\n                enableHighAccuracy: true, // 高精度定位\n                timeout: 10000, // 超时时间\n                buttonPosition: 'RB', // 定位按钮位置\n                zoomToAccuracy: true, // 定位成功后自动调整视野\n                showMarker: false // 禁用默认标记\n            });\n\n            MapInfo.addControl(geolocation);\n\n            // 绑定定位按钮点击事件\n            document.getElementById('locateBtn').addEventListener('click', () => {\n                startRealTimeLocation();\n            });\n        }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("blockquote",[n("p",[s._v("📌 使用"),n("strong",[s._v("AMap.Geolocation")]),s._v("插件提供设备定位，注意：高德仅支持"),n("strong",[s._v("单次定位")]),s._v("（getCurrentPosition）。")])]),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"_3️⃣-实现-伪实时定位"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3️⃣-实现-伪实时定位"}},[s._v("#")]),s._v(" 3️⃣ 实现“伪实时定位”")]),s._v(" "),n("p",[s._v("由于高德 API 本身不支持"),n("strong",[s._v("watchPosition")]),s._v("，需要用"),n("strong",[s._v("定时器+单次定位")]),s._v("模拟“实时监听”：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("       // 开始“伪实时”定位\n        function startRealTimeLocation() {\n            if (watchIntervalId) {\n                clearInterval(watchIntervalId);\n            }\n\n            if (userMarker) {\n                userMarker.setMap(null);\n            }\n\n            userMarker = new AMap.Marker({\n                map: MapInfo,\n                icon: new AMap.Icon({\n                    image: 'data:image/svg+xml;base64,...', // 省略图标\n                    size: new AMap.Size(24, 24)\n                }),\n                zIndex: 100,\n                offset: new AMap.Pixel(-12, -12)\n            });\n\n            watchIntervalId = setInterval(() => {\n                geolocation.getCurrentPosition((status, result) => {\n                    if (status === 'complete') {\n                        updateUserPosition(result);\n                    } else {\n                        console.error('定位失败:', result.message);\n                    }\n                });\n            }, 2000); // 每2秒定位一次\n        }\n\n        function updateUserPosition(result) {\n            const position = result.position;\n            const accuracy = result.accuracy;\n\n            userMarker.setPosition([position.lng, position.lat]);\n            MapInfo.setCenter([position.lng, position.lat]);\n            MapInfo.setZoom(16);\n\n            // 移除旧的精度圆\n            if (accuracyCircle) {\n                accuracyCircle.setMap(null);\n            }\n\n            // 绘制新的精度圆\n            accuracyCircle = new AMap.Circle({\n                center: [position.lng, position.lat],\n                radius: accuracy || 50,\n                strokeColor: '#3388FF',\n                strokeOpacity: 0.5,\n                strokeWeight: 1,\n                fillColor: '#3388FF',\n                fillOpacity: 0.2,\n                zIndex: 50,\n                map: MapInfo\n            });\n        }\n\n        // 页面加载后初始化\n        window.onload = initMap;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br")])]),n("blockquote",[n("p",[s._v("🎥 这样就能让设备位置"),n("strong",[s._v("自动动态刷新")]),s._v("，实现“追踪效果”。")])]),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"_4️⃣-绘制自定义定位标记与精度圆"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4️⃣-绘制自定义定位标记与精度圆"}},[s._v("#")]),s._v(" 4️⃣ 绘制自定义定位标记与精度圆")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("            userMarker = new AMap.Marker({\n                            map: MapInfo,\n                            icon: new AMap.Icon({\n                                image: 'data:image/svg+xml;base64,...', // 省略图标\n                                size: new AMap.Size(24, 24)\n                            }),\n                            zIndex: 100,\n                            offset: new AMap.Pixel(-12, -12)\n            });\n\n            // 移除旧的精度圆\n            if (accuracyCircle) {\n                accuracyCircle.setMap(null);\n            }\n\n            // 绘制新的精度圆\n            accuracyCircle = new AMap.Circle({\n                center: [position.lng, position.lat],\n                radius: accuracy || 50,\n                strokeColor: '#3388FF',\n                strokeOpacity: 0.5,\n                strokeWeight: 1,\n                fillColor: '#3388FF',\n                fillOpacity: 0.2,\n                zIndex: 50,\n                map: MapInfo\n            });\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("blockquote",[n("p",[s._v("✅ 精度圆用来展示“当前位置误差范围”，使地图交互更专业、可信。")])]),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"_5️⃣-地图自动跟随"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5️⃣-地图自动跟随"}},[s._v("#")]),s._v(" 5️⃣ 地图自动跟随")]),s._v(" "),n("p",[s._v("每次定位更新时：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("MapInfo.setCenter([position.lng, position.lat]);\nMapInfo.setZoom(16);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("这样地图会自动聚焦到最新的用户位置，配合精度圆形成“实时定位展示”。")]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"三、完整功能总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、完整功能总结"}},[s._v("#")]),s._v(" 三、完整功能总结")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("功能")]),s._v(" "),n("th",[s._v("实现方法")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("3D地图渲染")]),s._v(" "),n("td",[s._v("AMap.Map + mapStyle")])]),s._v(" "),n("tr",[n("td",[s._v("定位获取")]),s._v(" "),n("td",[s._v("AMap.Geolocation.getCurrentPosition")])]),s._v(" "),n("tr",[n("td",[s._v("实时定位监听")]),s._v(" "),n("td",[s._v("setInterval + 单次定位模拟")])]),s._v(" "),n("tr",[n("td",[s._v("自定义位置标记")]),s._v(" "),n("td",[s._v("AMap.Marker + 自定义SVG图标")])]),s._v(" "),n("tr",[n("td",[s._v("精度范围展示")]),s._v(" "),n("td",[s._v("AMap.Circle")])]),s._v(" "),n("tr",[n("td",[s._v("地图自动跟随")]),s._v(" "),n("td",[s._v("setCenter + setZoom")])])])]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"四、常见开发误区-⚠️"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、常见开发误区-⚠️"}},[s._v("#")]),s._v(" 四、常见开发误区 ⚠️")]),s._v(" "),n("p",[s._v("1️⃣ 误用 "),n("code",[s._v("geolocation.watchPosition()")])]),s._v(" "),n("blockquote",[n("p",[s._v("高德并未提供，需手动轮询模拟。")])]),s._v(" "),n("p",[s._v("2️⃣ 用 "),n("code",[s._v("setExtData()")]),s._v(" 存图层对象后调用 "),n("code",[s._v("setMap()")])]),s._v(" "),n("blockquote",[n("p",[s._v("图层对象应单独管理，避免报错与内存泄漏。")])]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"五、完整项目应用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、完整项目应用场景"}},[s._v("#")]),s._v(" 五、完整项目应用场景")]),s._v(" "),n("ul",[n("li",[s._v("🚖 网约车司机实时轨迹")]),s._v(" "),n("li",[s._v("🚴 骑行导航")]),s._v(" "),n("li",[s._v("🏃 户外运动轨迹记录")]),s._v(" "),n("li",[s._v("🛵 外卖/物流骑手追踪")]),s._v(" "),n("li",[s._v("🗺️ 智慧城市人员位置可视化")])]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"六、结语"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、结语"}},[s._v("#")]),s._v(" 六、结语")]),s._v(" "),n("p",[s._v("在高德地图 API 的开发中，掌握"),n("strong",[s._v("定时单次定位")]),s._v("模拟实时监听，合理管理图层对象，是实现高性能、稳定地图应用的关键。")]),s._v(" "),n("blockquote",[n("p",[s._v("💡 用高德地图打造属于你的“城市实时定位”系统，就从今天开始吧。")])])])}),[],!1,null,null,null);n.default=e.exports}}]);