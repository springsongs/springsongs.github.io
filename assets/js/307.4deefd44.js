(window.webpackJsonp=window.webpackJsonp||[]).push([[307],{605:function(a,t,s){"use strict";s.r(t);var n=s(4),e=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"offline-应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#offline-应用"}},[a._v("#")]),a._v(" Offline 应用")]),a._v(" "),t("p",[a._v("Web 应用不仅可以在浏览器缓存资源文件（HTML、CSS、JS 脚本、图片等），还可以把应用本身储存到浏览器。")]),a._v(" "),t("p",[a._v("缓存的资源文件必须在线使用，只有先从服务器加载网页，然后才能使用本地缓存；但是，应用一旦储存，就可以离线使用。另外，用户常规性地清除浏览器缓存，并不会清除储存的应用，除非用户显式地卸载或删除它们。")]),a._v(" "),t("p",[a._v("为了开启离线储存，必须创建一个 manifest 文件。该文件列出了所有需要储存的文件。")]),a._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[a._v("CACHE MANIFEST\nmyapp.html\nmyapp.js\nmyapp.css\nimages/background.png\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("p",[a._v("Manifest 文件的第一行必须是"),t("code",[a._v("CACHE MANIFEST")]),a._v("。然后，每一行列出一个需要储存的文件，它们的位置都是相对于 Manifest 文件的位置。空行会被忽略，以"),t("code",[a._v("#")]),a._v("开头的行是注释，也会被忽略。")]),a._v(" "),t("p",[a._v("这个文件的后缀名一般是"),t("code",[a._v(".appcache")]),a._v("。它的 MIME 类型必须是"),t("code",[a._v("text/cache-manifest")]),a._v("，如果服务器将其设为其他类型，就不会被浏览器缓存。")]),a._v(" "),t("p",[a._v("编写完这个文件以后，要将"),t("code",[a._v("<html>")]),a._v("元素的"),t("code",[a._v("manifest")]),a._v("属性指向它。浏览器加载这个网页的时候，就会读取这个 Manifest 文件，离线储存这个网页和相关的资源。")]),a._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[t("span",{pre:!0,attrs:{class:"token doctype"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<!")]),t("span",{pre:!0,attrs:{class:"token doctype-tag"}},[a._v("DOCTYPE")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token name"}},[a._v("HTML")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("html")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("manifest")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("myapp.appcache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("head")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("..."),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("head")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("..."),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("p",[a._v("如果一个 Web 应用有多个网页需要离线储存，那么每个网页都应该将"),t("code",[a._v("manifest")]),a._v("属性指向这个文件。一旦被储存，以后加载该网页的时候，就会从缓存里面加载。这时，只有 Manifest 文件里面列出的文件会被加载，其他文件不会。如果这时浏览器在线，浏览器就会去检查 Manifest 文件是否有新版本，如果有新版本，就会重新储存和更新该文件列出的资源。最方便的办法是在 Manifest 文件里面用注释列出版本号。")]),a._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[a._v("CACHE MANIFEST\n# MyApp version 1\nMyApp.html\nMyApp.js\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("如果需要删除离线储存，只要删除 Manifest 文件，让其返回 404 状态码即可。")]),a._v(" "),t("p",[a._v("离线储存更新完成，会触发浏览器的"),t("code",[a._v("updateready")]),a._v("事件，可以对这个事件指定监听函数。")]),a._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("applicationCache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[a._v("onupdateready")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),a._v(" reload "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("confirm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'新版本下载完成。是否需要重新加载？'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("reload"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" location"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("reload")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("脚本可以注册"),t("code",[a._v("online")]),a._v("和"),t("code",[a._v("offline")]),a._v("事件的监听函数，通过"),t("code",[a._v("navigator.onLine")]),a._v("属性，判断浏览器是否在线从而进行数据同步。")]),a._v(" "),t("p",[a._v("每次浏览器加载一个具有"),t("code",[a._v("manifest")]),a._v("属性的网页，浏览器就会触发一个"),t("code",[a._v("checking")]),a._v("事件，然后去加载 Manifest 文件。")]),a._v(" "),t("ul",[t("li",[a._v("如果应用已经储存，并且 Manifest 文件没有变化，那么触发"),t("code",[a._v("noupdate")]),a._v("事件。")]),a._v(" "),t("li",[a._v("如果应用已经储存，并且 Manifest 文件有变化，那么触发"),t("code",[a._v("downloading")]),a._v("事件，浏览器重新下载所有离线资源。下载过程中，触发"),t("code",[a._v("progress")]),a._v("事件，下载结束触发"),t("code",[a._v("updateready")]),a._v("事件。")]),a._v(" "),t("li",[a._v("如果应用没有储存，下载结束将触发"),t("code",[a._v("cached")]),a._v("事件。")]),a._v(" "),t("li",[a._v("如果离线，无法检查 Manifest 文件，浏览器会触发一个"),t("code",[a._v("error")]),a._v("事件。")]),a._v(" "),t("li",[a._v("如果浏览器在线，而且应用已经储存，但是 Manifest 文件返回 404，浏览器触发"),t("code",[a._v("obsolete")]),a._v("事件，将储存的应用移除。")])]),a._v(" "),t("p",[a._v("所有这些事件都是可以取消的。监听函数可以返回"),t("code",[a._v("false")]),a._v("，取消这些事件的默认动作。")]),a._v(" "),t("p",[t("code",[a._v("applicationCache. status")]),a._v("属性返回离线储存的状态。")]),a._v(" "),t("ul",[t("li",[a._v("ApplicationCache.UNCACHED (0)\nThis application does not have a manifest attribute: it is not cached.")]),a._v(" "),t("li",[a._v("ApplicationCache.IDLE (1)\nThe manifest has been checked and this application is cached and up to date.")]),a._v(" "),t("li",[a._v("ApplicationCache.CHECKING (2)\nThe browser is checking the manifest file.")]),a._v(" "),t("li",[a._v("ApplicationCache.DOWNLOADING (3)\nThe browser is downloading and caching files listed in the manifest.")]),a._v(" "),t("li",[a._v("ApplicationCache.UPDATEREADY (4)\nA new version of the application has been downloaded and cached.")]),a._v(" "),t("li",[a._v("ApplicationCache.OBSOLETE (5)\nThe manifest no longer exists and the cache will be deleted.")])])])}),[],!1,null,null,null);t.default=e.exports}}]);